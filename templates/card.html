{% extends 'base.html' %}
{% block title %}
{{article.title}}
{% endblock %}

{% block main %}
{{ ckeditor.load() }}
    <main>
        <div class="container my-5">
           {%if active_user.root==1%}
            <a href="/delete-article/{{article.id}}" class="btn btn-outline-danger mb-3">–£–¥–∞–ª–∏—Ç—å</a>
            {% if article.hide %}
                <button type="button" class="btn btn-success mb-3" data-bs-toggle="modal" data-bs-target="#approveModal">
                    –û–¥–æ–±—Ä–∏—Ç—å
                </button>
                <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è —Å –ø—Ä–∏—á–∏–Ω–æ–π -->
                <button type="button" class="btn btn-warning mb-3" data-bs-toggle="modal" data-bs-target="#rejectModal">
                    –û—Ç–∫–ª–æ–Ω–∏—Ç—å
                </button>
            {% else %}
                <a href="/change-status/{{article.id}}" class="btn btn-danger mb-3">–°–∫—Ä—ã—Ç—å</a>
            {% endif %}
        {% endif %}

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –æ–¥–æ–±—Ä–µ–Ω–∏—è -->
<div class="modal fade" id="approveModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">–û–¥–æ–±—Ä–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form action="/approve-article/{{article.id}}" method="post">
                <div class="modal-body">
                    <p>–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ–¥–æ–±—Ä–∏—Ç—å —ç—Ç–æ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-success">–û–¥–æ–±—Ä–∏—Ç—å</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è -->
<div class="modal fade" id="rejectModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">–û—Ç–∫–ª–æ–Ω–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form action="/reject-article/{{article.id}}" method="post">
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="rejectReason" class="form-label">–ü—Ä–∏—á–∏–Ω–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è:</label>
                        <textarea class="form-control" id="rejectReason" name="reason" rows="3" required></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-warning">–û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>
                </div>
            </form>
        </div>
    </div>
</div>
            {%if 'name' in session and active_user.id==article.id_user %}
            <button
              type="button"
              class="btn btn-warning mb-3"
              data-bs-toggle="modal"
              data-bs-target="#exampleModal"
            >
              –ò–∑–º–µ–Ω–∏—Ç—å
            </button>
            {%if active_user.root==0%}
            <a href="/delete-article/{{article.id}}" class="btn btn-danger mb-3">–£–¥–∞–ª–∏—Ç—å</a>
            {%endif%}
            <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
              <div class="modal-dialog modal-lg">
                <div class="modal-content">
                  <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">–ò–∑–º–µ–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                  </div>
                  <div class="modal-body">
                    <form method="post" enctype="multipart/form-data">
                      <div class="mb-3">
                        <label for="disabledTextInput" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                        <input type="text" value="{{article.title}}" id="disabledTextInput" class="form-control" name="title" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ"
                          required>
                      </div>
                      <div class="mb-3">
                        <label for="disabledTextInput" class="form-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–Ω–∞—Ç</label>
                        <input type="number" min="1" value="{{article.count_rooms}}" id="disabledTextInput" class="form-control" name="count_rooms" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–Ω–∞—Ç"
                          required>
                      </div>
                      <div class="mb-3">
                        <label for="exampleInputPassword1" class="form-label">–ê–¥—Ä–µ—Å (–ø—Ä–∏–º–µ—Ä —É–ª. –ö—É—Ä—á–∞—Ç–æ–≤–∞, 4, –ì—Ä–æ–¥–Ω–æ)</label>
                        <input type="text" value="{{article.address}}" class="form-control" name="address" placeholder="–ê–¥—Ä–µ—Å" id="exampleInputPassword1" required>
                      </div>
                    
          
                      <div class="mb-3">
                        <label for="disabledTextInput" class="form-label">–¶–µ–Ω–∞, —Ä—É–±.</label>
                        <input type="number" min="1" value="{{article.price}}" id="disabledTextInput" class="form-control" name="price" placeholder="–¶–µ–Ω–∞, —Ä—É–±."
                          required>
                      </div>

                      <div class="mb-3">
                        <label for="disabledTextInput" class="form-label">–≠—Ç–∞–∂</label>
                        <input type="number" min="1" value="{{article.floor}}" id="disabledTextInput" class="form-control" name="floor" placeholder="–≠—Ç–∞–∂"
                          >
                      </div>

                      <div class="mb-3">
                        <label for="disabledTextInput" class="form-label">–ü–æ–¥—ä–µ–∑–¥</label>
                        <input type="number" min="1" value="{{article.entrance}}" id="disabledTextInput" class="form-control" name="entrance" placeholder="–ü–æ–¥—ä–µ–∑–¥"
                          >
                      </div>

                      <div class="mb-3">
                        <label for="disabledTextInput" class="form-label">–¶–µ–Ω–∞, —Ä—É–±.</label>
                        <input type="number" min="1" value="{{article.price}}" id="disabledTextInput" class="form-control" name="price" placeholder="–¶–µ–Ω–∞, —Ä—É–±."
                          required>
                      </div>

                      <div class="mb-3">
                        <label for="disabledSelect" class="form-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                        <select name="category"  id="disabledSelect" class="form-select">
                          <option value="–ö–≤–∞—Ä—Ç–∏—Ä—ã">–ö–≤–∞—Ä—Ç–∏—Ä—ã</option>
                          <option value="–ö–æ–º–Ω–∞—Ç—ã">–ö–æ–º–Ω–∞—Ç—ã</option>
                          <option value="–î–æ–º–∞">–î–æ–º–∞</option>
                        </select>                     
                     </div>

                     <div class="mb-3">
                        <label for="disabledSelect" class="form-label">–¢–∏–ø –∞—Ä–µ–Ω–¥—ã</label>
                        <select name="type" id="disabledSelect" class="form-select">
                          <option value="–ü–æ—Å—É—Ç–æ—á–Ω–∞—è">–ü–æ—Å—É—Ç–æ—á–Ω–∞—è</option>
                          <option value="–ï–∂–µ–º–µ—Å—è—á–Ω–∞—è">–ï–∂–µ–º–µ—Å—è—á–Ω–∞—è</option>
                        </select>                     
                     </div>
                
                      <div class="mb-3">
                        <label for="disabledTextInput" class="form-label">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</label>
                        <input type="file" id="disabledTextInput" name="image" class="form-control" accept=".jpg,.jpeg,.png"
                          >
                      </div>
                      <div class="mb-3">
                        <h3>–°–æ–¥–µ—Ä–∂–∏–º–æ–µ</h3>
                        {{ ckeditor.create(value=article.text) }}
                      </div>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–ó–∞–∫—Ä—ã—Ç—å</button>
                    <button type="submit" class="btn btn-success">–ò–∑–º–µ–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å</button>
                  </div>
                  </form>
                </div>
              </div>
            </div>
            {%endif%}
            {% with messages = get_flashed_messages(True) %}
            {% if messages %}
            {% for category, message in messages %}
            <p class="m-2 flash {{category}}">{{message}}</p>
            {% endfor %}
            {% endif %}
            {% endwith %}
            <div class="row">
                <!-- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ -->
                <div class="col-md-6">
                  
                    <div class="gallery-main">
                        <div class='position-relative'> 
                            {% if article.hide %}
                  <div class="moderation-label">–ù–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏</div>
                  {% endif %}
                        <img id="mainImage" src="../../static/img/upload/{{article.image_name}}" width="100%" alt="–û—Å–Ω–æ–≤–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞">
                         </div>       
                        <div class="image-navigation my-2 d-flex justify-content-between">
                            <button class="btn btn-outline-success prev-btn" onclick="prevImage()">‚Üê</button>
                            <button class="btn btn-outline-success next-btn" onclick="nextImage()">‚Üí</button>
                        </div>
                        <div class="row gallery-thumbnails my-3">
                          <h3>–ì–∞–ª–µ—Ä–µ—è</h3>
                          <div class="col-md-4 mb-3">
                                <div class="card ">
                                    <img src="../../static/img/upload/{{article.image_name}}" onclick="changeImage(this.src)" class="card-img-top" alt="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ">
    
                                </div>
                            </div>
                            {%if article.images%}
                            {% for image in article.images %}
                            <div class="col-md-4 mb-3">
                                <div class="card">
                                    <img src="../../static/img/upload/{{image.image_name}}" onclick="changeImage(this.src)" class="card-img-top" alt="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ">
                                    {%if 'name' in session and active_user.id==article.id_user or active_user.root==1%}
                                    <div class="card-body text-center">
                                        <a href="/delete-image/{{image.id}}" class="btn btn-danger btn-sm">–£–¥–∞–ª–∏—Ç—å</a>
                                    </div>
                                    {%endif%}
                                </div>
                            </div>
                            {% endfor %}
                            {%endif%}
                             {%if 'name' in session and active_user.id==article.id_user or active_user.root==1%}
        <div class="mt-3">
            <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#uploadImagesModal">
                –î–æ–±–∞–≤–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
            </button>
            
            <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π -->
            <div class="modal fade" id="uploadImagesModal" tabindex="-1" aria-labelledby="uploadImagesModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="uploadImagesModalLabel">–î–æ–±–∞–≤–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <form method="post" enctype="multipart/form-data" action="/update-article-galery/{{article.id}}">
                            <div class="modal-body">
                                <div class="mb-3">
                                    <label for="images" class="form-label">–í—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–º–∞–∫—Å–∏–º—É–º 5)</label>
                                    <input class="form-control" type="file" id="images" name="images" multiple accept=".jpg,.jpeg,.png">
                                    <small class="text-muted">–ú–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ 5 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</small>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–ó–∞–∫—Ä—ã—Ç—å</button>
                                <button type="submit" class="btn btn-success">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        {%endif%}
                        </div>
                    </div>
                  
                </div>
                <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–≤–∞—Ä–µ -->
                <div class="col-md-6">
                    {%if article.id_user==active_user.id%}
                    <p class="text-muted">–≠—Ç–æ –≤–∞—à–µ –æ–±—å—è–≤–ª–µ–Ω–∏–µ!</p>
                    {%endif%}
                  
                    <h1>{{article.title}}</h1>
                    <p> <small>–î–æ–±–∞–≤–ª–µ–Ω–æ  {{article.created_at.strftime('%d.%m.%Y %H:%M' )}}</small></p>
                    <p class="text-muted">–ö–∞—Ç–µ–≥–æ—Ä–∏—è: {{article.category}}</p>
                    <p class="text-muted">–ê–¥—Ä–µ—Å: {{article.address}}</p>
                    {%if article.floor%}
                    <p class="text-muted">–≠—Ç–∞–∂: {{article.floor}}</p>
                    {%endif%}
                    {%if article.entrance%}
                    <p class="text-muted">–ü–æ–¥—ä–µ–∑–¥: {{article.entrance}}</p>
                    {%endif%}
                    <p class="lead">–¢–∏–ø –∞—Ä–µ–Ω–¥—ã: <strong>{{article.type_app}}</strong></p>
                    <p class="lead">–¶–µ–Ω–∞: <strong>{{article.price}} —Ä—É–±.</strong></p>
                    
                   
              
                    {% autoescape false %} {{article.text}} {% endautoescape %}
                   {%if not active_user  %}
                   <p>–î–ª—è –∑–∞–∫–∞–∑–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ <a href="/reg" class="text-success">–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è!</a> </p>
                   {%elif article.id_user==active_user.id%}
                  
             

                   {%else%}
                   <a href="/chat/{{article.id}}/{{article.users.id}}" class="btn btn-success btn-lg">–ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å –≤–ª–∞–¥–µ–ª—å—Ü—É</a>
                    <button class="btn btn-success btn-lg" data-bs-toggle="modal"
                    data-bs-target="#exampleModal2">–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å</button>

                    <div class="modal fade" id="exampleModal2" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h1 class="modal-title fs-5" id="exampleModalLabel">–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—ã</h1>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <form method="post" enctype="multipart/form-data" id="bookingForm" 
                                          action="{{url_for('add_order', id_user=active_user.id, id_article=article.id)}}">
                                        <div class="mb-3">
                                            <label for="datepicker" class="form-label">–î–æ—Å—Ç—É–ø–Ω—ã–µ –¥–∞—Ç—ã:</label>
                                            <input type="text" class="form-control" id="datepicker" placeholder="–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—ã" readonly>
                                            <input type="hidden" name="selected_dates" id="selectedDates">
                                            <div class="mt-2">
                                                <small class="text-muted">
                                                    {% if article.type_app == '–ü–æ—Å—É—Ç–æ—á–Ω–∞—è' %}
                                                        –í—ã–±–µ—Ä–∏—Ç–µ –Ω—É–∂–Ω—ã–µ –¥–∞—Ç—ã (–º–æ–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ)
                                                    {% else %}
                                                        –î–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ —á–∏—Å–ª–∞ –º–µ—Å—è—Ü–µ–≤
                                                    {% endif %}
                                                </small>
                                            </div>
                                            <div id="selectedDatesList" class="mt-2"></div>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–ó–∞–∫—Ä—ã—Ç—å</button>
                                            <button type="submit" class="btn btn-success">–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
 {%endif%}
            </div>
        </div>
         <div class="card shadow-sm my-4">
            <div class="card-header bg-light">
                <h5 class="card-title mb-0">üìç –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ</h5>
            </div>
            <div class="card-body p-0">
                <div id="map" style="height: 400px;"></div>
                <div id="map-error" class="alert alert-warning m-3 d-none">
                    <i class="bi bi-exclamation-triangle-fill me-2"></i>
                    –ê–¥—Ä–µ—Å –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ —É–∫–∞–∑–∞–Ω –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ.
                </div>
            </div>
        </div>
    </main>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const modal = document.getElementById('exampleModal2');
        const typeApp = '{{article.type_app}}';
    
        modal.addEventListener('shown.bs.modal', function() {
            fetch('/get_available_dates/{{article.id}}')
                .then(response => response.json())
                .then(availableDates => {
                    const config = {
                        locale: 'ru',
                        minDate: 'today',
                        mode: 'multiple', // –†–µ–∂–∏–º –≤—ã–±–æ—Ä–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –¥–∞—Ç
                        dateFormat: 'Y-m-d',
                        disableMobile: true,
                        enable: availableDates,
                        onChange: function(selectedDates, dateStr) {
                            if (!selectedDates || selectedDates.length === 0) {
                                document.getElementById('selectedDates').value = '';
                                document.getElementById('selectedDatesList').innerHTML = '';
                                return;
                            }
                        
                            // –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥–∞—Ç –±–µ–∑ —É—á–µ—Ç–∞ —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞
                            const dateStrings = selectedDates.map(d => {
                                const year = d.getFullYear();
                                const month = String(d.getMonth() + 1).padStart(2, '0');
                                const day = String(d.getDate()).padStart(2, '0');
                                return `${year}-${month}-${day}`;
                            });
                        
                            document.getElementById('selectedDates').value = JSON.stringify(dateStrings);
                            
                            // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –¥–∞—Ç
                            const datesList = document.getElementById('selectedDatesList');
                            datesList.innerHTML = '<p>–í—ã–±—Ä–∞–Ω–æ –¥–∞—Ç: ' + selectedDates.length + '</p><ul>';
                            
                            selectedDates.forEach(date => {
                                datesList.innerHTML += '<li>' + date.toLocaleDateString('ru-RU') + '</li>';
                            });
                            
                            datesList.innerHTML += '</ul>';
                        }
                    };
    
                    // –î–ª—è –µ–∂–µ–º–µ—Å—è—á–Ω–æ–π –∞—Ä–µ–Ω–¥—ã –æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –æ–¥–Ω—É –¥–∞—Ç—É
                    if (typeApp !== '–ü–æ—Å—É—Ç–æ—á–Ω–∞—è') {
                        config.mode = 'single';
                        const originalOnChange = config.onChange;
                        
                        config.onChange = function(selectedDates, dateStr, instance) {
                            if (selectedDates[0] && selectedDates[0].getDate() !== 1) {
                                instance.clear();
                                alert('–î–ª—è –µ–∂–µ–º–µ—Å—è—á–Ω–æ–π –∞—Ä–µ–Ω–¥—ã –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ —á–∏—Å–ª–∞ –º–µ—Å—è—Ü–µ–≤');
                                return;
                            }
                            originalOnChange(selectedDates, dateStr, instance);
                        };
                    }
    
                    flatpickr('#datepicker', config);
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –¥–∞—Ç:', error);
                });
        });
    
        // –û—á–∏—â–∞–µ–º –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏
        modal.addEventListener('hidden.bs.modal', function() {
            const fp = document.querySelector('#datepicker')._flatpickr;
            if (fp) {
                fp.clear();
                fp.destroy();
            }
            document.getElementById('selectedDates').value = '';
            document.getElementById('selectedDatesList').innerHTML = '';
        });
    
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
        document.getElementById('bookingForm').addEventListener('submit', function(e) {
            const selectedDates = JSON.parse(document.getElementById('selectedDates').value || '[]');
            if (selectedDates.length === 0) {
                e.preventDefault();
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –¥–∞—Ç—É');
            }
        });
    });</script>



 <script>
        const address = "{{ article.address }}";
        const mapElement = document.getElementById('map');
        const errorElement = document.getElementById('map-error');

        fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(address)}`)
            .then(response => response.json())
            .then(data => {
                if (data.length === 0) {
                    // –ê–¥—Ä–µ—Å –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É
                    mapElement.style.display = 'none';
                    errorElement.classList.remove('d-none');
                } else {
                    // –ê–¥—Ä–µ—Å –Ω–∞–π–¥–µ–Ω ‚Üí —Ä–µ–Ω–¥–µ—Ä–∏–º –∫–∞—Ä—Ç—É
                    errorElement.classList.add('d-none');
                    mapElement.style.display = 'block';

                    const lat = parseFloat(data[0].lat);
                    const lon = parseFloat(data[0].lon);
                    
                    const map = L.map('map').setView([lat, lon], 15);
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'
                    }).addTo(map);
                    
                    L.marker([lat, lon])
                        .addTo(map)
                        .bindPopup("<b>{{ article.title }}</b><br>" + address)
                        .openPopup();
                }
            })
            .catch(error => {
                console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∫–∞—Ä—Ç—ã:", error);
                mapElement.style.display = 'none';
                errorElement.classList.remove('d-none');
                errorElement.textContent = "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ä—Ç—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.";
            });
    </script>


<script>
    // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≥–∞–ª–µ—Ä–µ–∏
    const galleryImages = [
        "../../static/img/upload/{{article.image_name}}",
        {% for image in article.images %}
        "../../static/img/upload/{{image.image_name}}",
        {% endfor %}
    ].filter(Boolean); // –£–¥–∞–ª—è–µ–º –ø—É—Å—Ç—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã, –µ—Å–ª–∏ images –Ω–µ—Ç
    
    let currentImageIndex = 0;
    
    function changeImage(src) {
        document.getElementById('mainImage').src = src;
        // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â–∏–π –∏–Ω–¥–µ–∫—Å
        currentImageIndex = galleryImages.indexOf(src);
    }
    
    function prevImage() {
        if (galleryImages.length === 0) return;
        
        currentImageIndex = (currentImageIndex - 1 + galleryImages.length) % galleryImages.length;
        document.getElementById('mainImage').src = galleryImages[currentImageIndex];
    }
    
    function nextImage() {
        if (galleryImages.length === 0) return;
        
        currentImageIndex = (currentImageIndex + 1) % galleryImages.length;
        document.getElementById('mainImage').src = galleryImages[currentImageIndex];
    }
</script>


    {% endblock %}
